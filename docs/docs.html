<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
          <script src="https://kit.fontawesome.com/52e3142fe2.js" crossorigin="anonymous"></script>
        <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Roboto&display=swap" rel="stylesheet">
     <title>Scribler | Dashboard</title>
     <base href="http://localhost:3000/">
        <style>
        
        /* Mobile first design */
        
        
            html, body {
                height: 100%;
                background-color: white;
		position: relative;
                font-size: 1em;
		overflow-x: hidden;
		min-height: 100%;
               /* background-image: url(https://miro.medium.com/max/10000/0*XBfvU6TPUxcBYcND);
                background-repeat: no-repeat;
                background-size: cover; */ 
            }
             
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
		user-select: none;
            }
            
            header:not(.board) {
                height: 15%;
                width: 100vw;
                max-height: 90px;
                background-color: white;
                display: flex;
                position: relative;
                align-items: center;
                justify-content: space-between;
                z-index: 1;
                padding-left: 5%;
                border-bottom: 1px solid #E1E1E1;
                min-height: 50px;
                padding-right: 5%;
            }
            
            .menu i {
                position: relative;
                font-size: 2em;
                color: #FF3C00;
            }


            .menu i::after {
                position: absolute;
                color: white;
                font-size: 0.3em;
                background: red;
                text-align: center;
                content: /*notifications*/;
                transform: translate(calc(-15px/2),calc(calc(-15px/2)));
                line-height: 15px;
                width: 15px;
                height: 15px;
                border: 3px solid white;
                border-radius: 15px;
            }
            
            p, h1, h2, footer, button {
              font-family: 'Roboto', sans-serif;
            }
            
            .logo {
                color: #FF3C00;             
                font-size: 2em;
                font-family: 'Lobster', cursive;
            }                                                                                
            
            .intro {
                font-size: calc(4vw + 3px);
                z-index: 1;
            }
            
            .buttons {
                height: 100%;
                min-height: 40px;
                width: auto;
                display: flex;
                justify-content: space-around;
                z-index: 1;
                flex-wrap: wrap;
            }
            
            .btn {
                width: 30%;
                height: 100%;
                border-radius: 25px;
                border: none;
                background: #FF3C00;
                color: white;
                font-size: 1em;
            }
            
            footer {
               width: 100vw;
               height: 25%;
               padding-left: 5%;
	       position: static;
               padding-right 5%;
               min-height: 50px;
               text-align: center;
               background-color: #333333;
            }
            
            .copyright {
                width: auto;
                height: 20%;
                text-align: center;
                position: relative;
                color: white;
                top: 40%;
            }
            
            main {
                z-index: 0;
            }
            
            #dropdown {
             position: absolute;
             width: 150px;
             z-index: 3;
             box-sizing: content-box;
             height: 200px;
             padding-top: 25px;
             padding-bottom: 25px;
             display: none;
             top: 1.5em;
             display: grid;
             grid-template-rows: 20% 20% 20% 20% 20%;
             right: 0;
             opacity: 0;
             transition: opacity 0.2s ease;
             background: white;
             box-shadow: 0px 0px 5px #c6c6c6;
            } 
            
            nav a {
                text-align: center;
                height: 40px;
                padding: 8%;
                margin: auto;
                text-decoration: none;
                color: #FF3C00;
                user-select: none;
                font-family: 'Roboto', sans-serif;
                display: block;
                font-size: 50%;
            }
            
            .content {
                height: 100%;
		position: relative;
                width: 100%;
		min-height: 100%;
            }

	    .menu {
            display: flex;                                                                                                                                                 flex-direction: row;
            align-items: center;                                                                                                                                           justify-content: flex-end;                                                                                                                                     width: 10%;                                                                                                                                                    }

            #username {
            color: #E1E1E1;                                                                                                                                                font-size: 80%;                                                                                                                                                white-space: nowrap;                                                                                                                                           text-overflow: ellipse;                                                                                                                                        margin-right: 50%;                                                                                                                                             }
            
            .dashboard {
              /*  min-height: calc(90% + 200px); */
		    min-height: 100%;
             /*   display: flex; */
                width: 100%;
             /*   align-items: flex-start;
                flex-direction: column; */
		position: relative;
                background: white;
		padding-bottom: 10%;
            }
            
            .board {
                position: relative;
                width: 100%;
                height: 10vmin;
                background: yellow;
                display: flex;
                align-items: center;
                box-shadow: 0px 0px 5px #c6c6c6;
                color: #FF3C00;
                font-family: 'Roboto', sans-serif;
                justify-content: space-around;
                background: white;
                min-height: 30px;
            }
            
            .tab {
                height: 100%;
                display: flex;
                align-items: center;
            }

	    .tab a {
             text-decoration: none;
	     color: #FF3C00;
	    }
            
            .tab-docs {
                border-bottom: 5px solid #FF3C00;
            }
                    
            .no-docs {
                color: #c6c6c6;
                position: relative;
		margin: auto;
                text-align: center;
		/* new */
		height: 350px;
		line-height: 350px;
            }
            
            .doc {
            width: 100%;
            min-width: 200px;
            min-height: 200px;
	    height: 100%;
	    border: 1px solid #E1E1E1;
	    max-height: 25vmin;
	    }
	    
	    .text {
	        height: 80%;
	        text-align: center;
	        padding: 5%;
	        font-size: 80%;
	        display: flex;
	        flex-direction: column;
	        justify-content: flex-start;
		overflow: hidden;
	    }
	    
	    .text h1 {
	        white-space: nowrap;
	        overflow: hidden;
                min-height: 1.2em;
	        text-overflow: ellipsis;
	        color: #c6c6c6;
	    }
	    
	    .text > div > p {
	        color: #E1E1E1;
	        word-wrap: break-word;
	        text-align: left;
	    }

	    .text > div {
            height: auto;
	    width: auto;
            overflow: hidden;
	    }
	    
	    .options {
	        height: 20%;
	        padding-left: 10%;
	        padding-right: 10%;
	        box-shadow: 0px 0px 5px #c6c6c6;
	        display: flex;
	        justify-content: space-around;
	        align-items: center;
	    }

	    #heading {
            width: 90%;
	    text-align: left;
	    color: gray;
	    margin: auto;
	    height: auto;
	    display: flex;
	    flex-direction: row;
	    justify-content: space-between;
	    padding-top: 5%;
	    border-bottom: 1px solid #E1E1E1;
	    }

            #preview, #edit {
            width: 100%;
	    height: 100%;
	    background: rgba(0,0,0,0.8);
	    position: fixed;
	    padding: 5%;
	    display: none;
	    box-sizing: border-box;
	    z-index: 5;
	    overflow: scroll;
	    }

	    #edit-but {
            width: 30%;
	    height: 10%;
	    min-width: 80px;
	    position: relative;
	    display: block;
	    min-height: 40px;
	    left: 35%;
	    max-width: 250px;
	    max-height: 60px;
	    background: none;
	    border: 1px solid white;
	    color: white;
            font-family: 'Roboto', sans-serif;
	    border-radius: 25px;
	    }

	    #edit {
	    height: 100%;
	    }

            #pre-title {
            font-size: 2em;
	    color: white;
	    text-align: left;
	    }

	    #pre-date {
            font-size: 1em;
	    color: white;
	    }

	    #preview i {
            font-size: 2em;
	    color: white;
	    }

	    #edit i {
            font-size: 2em;
	    color: white;
	    }

	    #edit-title {
            width: 60%;
	    height: 100%;
	    max-height: 60%;
	    color: white;
	    font-size: 3em;
	    font-family: 'Roboto', sans-serif;
	    background: none;
	    border: 1px solid white;
	    min-height: 50px;
	    padding: 2%;
            }

	    #edit-body {
            width: 100%;
	    height: 100%;
	    min-height: 300px;
	    margin: auto;
	    font-family: 'Roboto', sans-serif;
	    color: white;
	    padding: 2%;
	    background: none;
	    border: 1px solid white;
	    }

	    #pre-top, #edit-top {
           display: flex;
	   flex-direction: row;
	   justify-content: space-between;
	   align-items: center;
	   width: 100%;
	   height: 10%;
	    }

	    #edit-top {
            height: 20%;
	    max-height: 80px;
	    }

	    #edit-title {
            color: white;
	    font-size: 1em;
	    }

	    #pre-body {
            top: 5%;
	    color: white;
	    word-break: break-word;
	    position: relative;
	    }

	    #heading h1 {
            font-size: 2em;
	    } 

	    #totalDocs {
            font-size: 2em;
	    }

	    .options i {
	        color: gray;
	    }

            /* Tablets */
            
            @media only screen and (min-width: 481px) and (max-width: 768px) {
       
            }
            
            /* Small screens and laptops */
            
            @media only screen and (min-width: 769px) and (max-width: 1024px) {
                
          
            }
            
            /* Desktops and large screens */
            
            @media only screen and (min-width: 1025px) and (max-width: 1200px) {
                
            }
            
            /* Extra large screens */ 
            
            @media only screen and (min-width: 1201px) {
                
            }
            
        
        </style>
    </head>
    <body>
	    <div id="edit">                                                                                                                                                                           <div id="edit-top">
			    <input id="edit-title" maxLength="50"><i class="fas fa-times" onclick="exitPreview()"></i>
                    </div>
		    <br>
		    <textarea id="edit-body"></textarea>
		    <br>
		    <br>
		    <button id="edit-but"><i>Save</i></button>
                       <br>
            </div>

	    <div id="preview">
		    <div id="pre-top">
			 <h2 id="pre-date"></h2><i class="fas fa-times" onclick="exitPreview()"></i>
		    </div>
			       <h1 id="pre-title"></h1>  
		       <p id="pre-body"></p>  
		       <br>
	    </div>
        <header>
		<h1 class="logo" onclick="location.href='http://localhost:3000'"><i>Scribler</i></h1>
            <div class="menu">
		    <p id="username">{username}</p>
            <i class="fas fa-bars" id="menu">
		    <nav id="dropdown">
                    <a href="" id="home">Home</a>
                    <a href="" id="about">About</a>
                    <a href="" id="contact">Contact</a>
		    <a href="users/dashboard/docs" id="dashboard">Dashboard</a>
		    <a id="logout" href="users/logout">Logout</a>
                </nav>
            </i>
            </div>
        </header>
        <div class="content">
          <header class="board">
              <div class="tab tab-new">
		      <a class="new" href="users/dashboard/new">New</a>
                </div>
                <div class="tab tab-docs">
			<a class="docs" href="users/dashboard/docs">Docs</a>
                </div>
                <div class="tab tab-friends">
			<a class="friends" href="users/dashboard/friends">Friends</a>
                </div>
		<div class="tab tab-recent">                                                                                                                                           <a class="recent" href="users/dashboard/recent">Recent</a>                                                                                                     </a>
            </header>
	    <div id="heading"><h1>My Documents</h1><h1 id="totalDocs"></h1></div>
            <section class="dashboard">
                <div class="no-docs">
               <p>You dont have any documents!</p>
               </div>
            </section> 
        <footer>
           <p class="copyright">&#169 Copyright 2020 Scribler Inc</p>
	</footer>
	</div>
	<script src="app.js"></script>
	<script type="text/javascript">
	
	// Retreive users documents...

	     var documents = {};
	
		fetch("http://localhost:3000/docs/all").then(res => {
               return res.json();
		}).then(json => {
			json.result.reverse();
			if (json.result[0] !== undefined) {
                           render(json.result);
			}
		}) 
		
		function render(arr) {

			document.getElementById("totalDocs").innerText = arr.length;
		    let dashboard = document.querySelector(".dashboard");
		    document.querySelector(".no-docs").style.display = "none";
		    dashboard.style.display = "grid";
		    dashboard.style.justifyContent = "center";
		    dashboard.style.paddingLeft = "5%";
		    dashboard.style.paddingRight = "5%";
		    dashboard.style.gridTemplateColumns = "repeat(auto-fill,minmax(200px,1fr))";
	            dashboard.style.gridAutoRows = "200px";
		    dashboard.style.paddingTop = "5%";
		    dashboard.style.gridGap = "5vmin";
		    
   for (let i of arr) {
       
       let doc = document.createElement("div");

          documents[i._id] = {
           creator: i.creator,
           title: i.title,
           body: i.main,
           date: i.dateMade,
           writers: i.writers
	  }
	              doc.setAttribute("data-id",i._id);
                      let text = document.createElement("div");
	              let overflow = document.createElement("div");
                      text.setAttribute("class","text");
                      let options = document.createElement("div");
                      options.setAttribute("class","options");
                      
                      let pen = document.createElement("i");
                      pen.setAttribute("class","fas fa-pen");
	              pen.addEventListener("click",() => {
			      let docObj = documents[doc.getAttribute("data-id")];
			      if (docObj.writers.includes("{username}")) {
			          document.querySelector("#edit-but").onclick = () => {
                           doc.getElementsByTagName("h1")[0].innerText = document.querySelector("#edit-title").value;
			   doc.getElementsByTagName("p")[0].innerText = document.querySelector("#edit-body").value;
			         exitPreview();

                                 docObj.title = document.querySelector("#edit-title").value;
					  docObj.body = document.querySelector("#edit-body").value;
			         
			         fetch("http://localhost:3000/docs/edit", {
			             method: "POST",
			             body: JSON.stringify({
			                 id: doc.getAttribute("data-id"),
			                 title: document.querySelector("#edit-title").value,
			                 main:document.querySelector("#edit-body").value
			             })
			         })
			          }
                                   edit(docObj.title,docObj.body,doc);
			      } else {
                           alert("You dont have permission to edit this document!");
			      }
		      })
                      let eye = document.createElement("i");
	              eye.addEventListener("click",() => {
			      let parent = eye.parentElement.parentElement.getAttribute("data-id");
			      let docu = documents[parent];
                         preview(docu.title,docu.body,docu.date.slice(0,10));
		      })

                      eye.setAttribute("class","fas fa-eye");
                      let trash = document.createElement("i");
                      trash.setAttribute("class","fas fa-trash");
	 
	             trash.addEventListener("click",() => {
			      if (documents[trash.parentElement.parentElement.getAttribute("data-id")].creator == "{username}") {
                       if (window.confirm("Delete this document?")) {
                           remove();
                           fetch("http://localhost:3000/docs/delete",{
				   method: "POST",
				   body: JSON.stringify({
					   id: trash.parentElement.parentElement.getAttribute("data-id")
				   })
			   })
		       }
			      } else {                                                                            
			          if (window.confirm("Remove this document?")) {   
			              remove();
			              fetch("http://localhost:3000/docs/delete",{                                                          method: "POST",
                                   body: JSON.stringify({
					   username: "{username}",
                         id: trash.parentElement.parentElement.getAttribute("data-id")                                                })
                           })
			      }
			      }
			   }) 

             function remove() {
                        let child = trash.parentElement.parentElement;
			      document.querySelector(".dashboard").removeChild(child);
			       delete documents[child.getAttribute("data-id")];
			       document.querySelector("#totalDocs").innerText = Object.keys(documents).length;
			       if (Object.keys(documents).length === 0) {
				       document.querySelector("#totalDocs").innerText = "";
                      
                                       let dashboard = document.querySelector(".dashboard");                                                                                                                           dashboard.style.minHeight = "calc(90% + 200px)";                                                       
		dashboard.style.display = "flex";
                    dashboard.style.justifyContent = "center";
		    dashboard.style.alignItems = "center";
		    dashboard.style.minWidth = "90%";
                    dashboard.style.paddingLeft = "0";
                    dashboard.style.paddingRight = "0";
                    dashboard.style.gridTemplateColumns = "none";      
				       dashboard.style.alignItems = "center";
				       dashboard.style.paddingTop = "0";                                                                                                                                                   dashboard.style.gridGap = "0";
				       dashboard.style.flexDirection = "column";
				       dashboard.style.paddingBottom = "10%";

				       document.querySelector(".no-docs").style.display = "initial";
				       document.querySelector(".no-docs").style.top = "0";
				       
			       }
             }
                      
                      options.appendChild(pen);
                      options.appendChild(eye);
                      options.appendChild(trash);
                      
			   for (let x in i) {
                              if (x == "title") {
                                  let title = document.createElement("h1");
				      title.innerText = i[x];
				      text.appendChild(title);
				      text.appendChild(document.createElement("br"));
			      } else if (x == "main") {
                    let main = document.createElement("p");
				      main.innerText = i[x].length < 200 ? i[x]:i[x].slice(0,181) + "...";
				      overflow.appendChild(main);
				      text.appendChild(overflow);
			       }
			      }
			      
                 doc.setAttribute("class","doc");
                 doc.appendChild(text);
                 doc.appendChild(options);
                 dashboard.appendChild(doc);
   }
             }

         function preview(title,body,dateMade) {
		 document.body.style.overflow = "hidden";
            document.querySelector("#preview").style.display = "block";
            document.querySelector("#pre-title").innerText = title;
		 document.querySelector("#pre-date").innerText = dateMade;
            document.querySelector("#pre-body").innerText = body;
	 }

		function edit(title,body,doc) {
                   document.querySelector("#edit").style.display = "block";
		  document.querySelector("#edit-title").value = title;
		document.querySelector("#edit-body").value = body;
		}

         function exitPreview() {
          document.body.style.overflow = "scroll";
          document.querySelector("#preview").style.display = "none";
		 document.querySelector("#edit").style.display = "none";
	 }

	</script>
    </body>
</html>
